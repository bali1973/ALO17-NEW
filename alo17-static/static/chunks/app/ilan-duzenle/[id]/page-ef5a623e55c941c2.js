(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6407],{12926:(e,a,s)=>{"use strict";s.d(a,{As:()=>o,default:()=>d});var t=s(95155),l=s(12115),i=s(50626);let r=(0,l.createContext)(void 0);function n(e){let{children:a}=e,[s,i]=(0,l.useState)(null),[n,o]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/session");if(e.ok){let a=await e.json();a.user&&i({user:a.user})}}catch(e){console.error("Auth check failed:",e)}finally{o(!1)}})()},[]),(0,t.jsx)(r.Provider,{value:{session:s,isLoading:n,setSession:i},children:a})}function o(){let e=(0,l.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}let c=(0,l.createContext)(void 0);function u(e){let{children:a}=e,[s,r]=(0,l.useState)("tr"),[n,o]=(0,l.useState)(0);return(0,l.useEffect)(()=>(i.Ru.loadLocaleFromStorage(),r(i.Ru.getCurrentLocale()),i.Ru.onLocaleChange(e=>{r(e),o(e=>e+1),window.location.reload()})),[]),(0,t.jsx)(c.Provider,{value:{currentLocale:s,setLocale:e=>{i.Ru.setLocale(e)},forceRefresh:()=>{o(e=>e+1),window.location.reload()}},children:(0,t.jsx)("div",{children:a},n)})}function d(e){let{children:a}=e;return(0,t.jsx)(n,{children:(0,t.jsx)(u,{children:a})})}},22732:(e,a,s)=>{"use strict";s.d(a,{C:()=>n,j:()=>r});var t=s(34953),l=s(19667);let i=e=>fetch(e).then(e=>e.json());function r(){let{data:e,error:a}=(0,t.Ay)("/api/categories",i);return{categories:e||[],isLoading:!a&&!e,isError:a}}function n(){(0,l.j)("/api/categories")}},29360:(e,a,s)=>{Promise.resolve().then(s.bind(s,99997))},35695:(e,a,s)=>{"use strict";var t=s(18999);s.o(t,"useParams")&&s.d(a,{useParams:function(){return t.useParams}}),s.o(t,"usePathname")&&s.d(a,{usePathname:function(){return t.usePathname}}),s.o(t,"useRouter")&&s.d(a,{useRouter:function(){return t.useRouter}}),s.o(t,"useSearchParams")&&s.d(a,{useSearchParams:function(){return t.useSearchParams}})},99997:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>o});var t=s(95155),l=s(12115),i=s(35695),r=s(12926),n=s(22732);function o(){var e,a;let s=(0,i.useRouter)(),o=(0,i.useParams)(),{session:c,isLoading:u}=(0,r.As)(),{categories:d,loading:m}=(0,n.j)(),[h,x]=(0,l.useState)({title:"",description:"",price:"",category:"",subcategory:"",condition:"",location:"",images:[]}),[p,g]=(0,l.useState)(!0),[b,v]=(0,l.useState)(""),[f,j]=(0,l.useState)("");(0,l.useEffect)(()=>{let e=async()=>{g(!0),v("");try{var e,a,s;let t=await fetch("/api/listings/".concat(o.id));if(!t.ok)throw Error("İlan bulunamadı veya yetkiniz yok.");let l=await t.json();if((null==c||null==(e=c.user)?void 0:e.role)!=="admin"&&l.email!==(null==c||null==(a=c.user)?void 0:a.email)){v("Bu ilanı d\xfczenleme yetkiniz yok."),g(!1);return}x({title:l.title||"",description:l.description||"",price:(null==(s=l.price)?void 0:s.toString())||"",category:l.category||"",subcategory:l.subcategory||"",condition:l.condition||"",location:l.location||"",images:Array.isArray(l.images)?l.images:l.images?[l.images]:[]})}catch(e){v(e.message||"İlan bulunamadı.")}finally{g(!1)}};(null==c?void 0:c.user)&&e()},[o.id,null==c?void 0:c.user]);let y=e=>{x({...h,[e.target.name]:e.target.value})},N=async e=>{e.preventDefault(),v(""),j("");try{var a,t;let e=await fetch("/api/listings/".concat(o.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...h,price:parseFloat(h.price),userEmail:null==c||null==(a=c.user)?void 0:a.email,userRole:null==c||null==(t=c.user)?void 0:t.role})});if(e.ok)j("İlan başarıyla g\xfcncellendi!"),setTimeout(()=>s.push("/profil"),1200);else{let a=await e.json();v(a.error||"G\xfcncelleme başarısız.")}}catch(e){v(e.message||"G\xfcncelleme başarısız.")}};return p||u?(0,t.jsx)("div",{className:"p-8 text-center",children:"Y\xfckleniyor..."}):b?(0,t.jsx)("div",{className:"p-8 text-center text-red-600",children:b}):(0,t.jsxs)("div",{className:"max-w-2xl mx-auto p-8 bg-white rounded-lg shadow mt-8",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"İlanı D\xfczenle"}),(0,t.jsxs)("form",{className:"space-y-6",onSubmit:N,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Başlık"}),(0,t.jsx)("input",{name:"title",value:h.title,onChange:y,className:"w-full border px-3 py-2 rounded",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"A\xe7ıklama"}),(0,t.jsx)("textarea",{name:"description",value:h.description,onChange:y,className:"w-full border px-3 py-2 rounded",rows:4,required:!0})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Fiyat (₺)"}),(0,t.jsx)("input",{name:"price",type:"number",value:h.price,onChange:y,className:"w-full border px-3 py-2 rounded",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Durum"}),(0,t.jsxs)("select",{name:"condition",value:h.condition,onChange:y,className:"w-full border px-3 py-2 rounded",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Durum se\xe7in"}),(0,t.jsx)("option",{value:"Yeni",children:"Yeni"}),(0,t.jsx)("option",{value:"İkinci El",children:"İkinci El"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Kategori"}),(0,t.jsxs)("select",{name:"category",value:h.category,onChange:y,className:"w-full border px-3 py-2 rounded",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Kategori se\xe7in"}),d.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Alt Kategori"}),(0,t.jsxs)("select",{name:"subcategory",value:h.subcategory,onChange:y,className:"w-full border px-3 py-2 rounded",children:[(0,t.jsx)("option",{value:"",children:"Alt kategori se\xe7in"}),null==(a=d.find(e=>e.id===h.category))||null==(e=a.subCategories)?void 0:e.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Lokasyon"}),(0,t.jsx)("input",{name:"location",value:h.location,onChange:y,className:"w-full border px-3 py-2 rounded",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Mevcut Resimler"}),(0,t.jsx)("div",{className:"flex gap-2 flex-wrap",children:h.images.length>0?h.images.map((e,a)=>(0,t.jsx)("img",{src:e,alt:"İlan g\xf6rseli",className:"w-24 h-24 object-cover rounded border"},a)):(0,t.jsx)("span",{className:"text-gray-400",children:"Resim yok"})})]}),(0,t.jsxs)("div",{className:"flex gap-4 mt-6",children:[(0,t.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",children:"Kaydet"}),(0,t.jsx)("button",{type:"button",className:"bg-gray-400 text-white px-6 py-2 rounded hover:bg-gray-500",onClick:()=>s.push("/profil"),children:"İptal"})]}),f&&(0,t.jsx)("div",{className:"text-green-600 mt-2",children:f}),b&&(0,t.jsx)("div",{className:"text-red-600 mt-2",children:b})]})]})}}},e=>{e.O(0,[4953,626,8441,5964,7358],()=>e(e.s=29360)),_N_E=e.O()}]);