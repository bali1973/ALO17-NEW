(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{4651:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>g});var r=t(95155),l=t(12115),a=t(6874),i=t.n(a),n=t(66766),o=t(51976),c=t(92657),d=t(12926),m=t(95060),u=t(46519);function x(e){let{allListings:s}=e,[t,a]=(0,l.useState)([]),[i,n]=(0,l.useState)([]);return((0,l.useEffect)(()=>{try{let e=JSON.parse(localStorage.getItem("recentlyViewed")||"[]");a(e)}catch(e){a([])}},[]),(0,l.useEffect)(()=>{t.length>0?n(t.map(e=>s.find(s=>s.id==e)).filter(Boolean)):n([])},[t,s]),0===i.length)?null:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-alo-dark",children:"Son Baktıkların"}),(0,r.jsx)("button",{onClick:()=>{a([]),n([]),localStorage.setItem("recentlyViewed","[]")},className:"px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-xs",children:"Temizle"})]}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:i.map(e=>(0,r.jsx)(u.l,{listing:e},e.id))})]})}function g(){let{session:e}=(0,d.As)(),[s,t]=(0,l.useState)([]),[a,u]=(0,l.useState)([]),[g,h]=(0,l.useState)(!0),[p,b]=(0,l.useState)(""),[f,y]=(0,l.useState)(""),[v,j]=(0,l.useState)(""),[w,N]=(0,l.useState)({min:"",max:""}),[k,A]=(0,l.useState)("premium"),[S,C]=(0,l.useState)(1),[L,D]=(0,l.useState)(new Set),F=e=>{let s=new Set(L);s.has(e)?s.delete(e):s.add(e),D(s)};(0,l.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/categories");if(e.ok){let s=await e.json();u(s)}}catch(e){}};(async()=>{try{console.log("Fetching listings from API...");let e=await fetch("/api/listings");if(console.log("API Response status:",e.status),e.ok){let s=await e.json();console.log("API Data:",s),console.log("Data type:",typeof s),console.log("Is array:",Array.isArray(s)),console.log("Data length:",s.length),Array.isArray(s)?(t(s),console.log("Listings set successfully:",s.length,"items")):(console.error("API did not return an array"),t([]))}else console.error("API response not ok:",e.status),t([])}catch(e){console.error("Error fetching listings:",e),t([])}finally{h(!1)}})(),e()},[]);let E=e=>{var s,t,r,l;let a=0;return(e.isPremium||e.premium)&&(a+=100),(null==(s=e.premiumFeatures)?void 0:s.includes("featured"))&&(a+=50),(null==(t=e.premiumFeatures)?void 0:t.includes("urgent"))&&(a+=30),(null==(r=e.premiumFeatures)?void 0:r.includes("highlighted"))&&(a+=20),(null==(l=e.premiumFeatures)?void 0:l.includes("top"))&&(a+=10),a+=e.views||0},T=Array.isArray(s)?s.filter(e=>e.title.toLowerCase().includes(p.toLowerCase())||e.description.toLowerCase().includes(p.toLowerCase())||e.category.toLowerCase().includes(p.toLowerCase())||e.subcategory.toLowerCase().includes(p.toLowerCase())||e.city.toLowerCase().includes(p.toLowerCase())).filter(e=>!f||e.category===f).filter(e=>!v||e.subcategory===v).filter(e=>{let s="number"==typeof e.price?e.price:parseFloat(String(e.price)),t=w.min?parseFloat(w.min):0,r=w.max?parseFloat(w.max):1/0;return s>=t&&s<=r}).sort((e,s)=>{switch(k){case"newest":return new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime();case"oldest":return new Date(e.createdAt).getTime()-new Date(s.createdAt).getTime();case"price-low":return("number"==typeof e.price?e.price:parseFloat(String(e.price)))-("number"==typeof s.price?s.price:parseFloat(String(s.price)));case"price-high":return("number"==typeof s.price?s.price:parseFloat(String(s.price)))-("number"==typeof e.price?e.price:parseFloat(String(e.price)));case"views":return(s.views||0)-(e.views||0);default:return E(s)-E(e)}}):[],P=T.filter(e=>e.isPremium||e.premium).slice(0,3),R=12*S,I=T.slice(R-12,R),_=Math.ceil(T.length/12),z=e=>{C(e),window.scrollTo({top:0,behavior:"smooth"})};return g?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((e,s)=>(0,r.jsx)("div",{className:"bg-white rounded-lg shadow animate-pulse",children:(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded mb-3"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded mb-3"}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("div",{className:"h-6 bg-gray-200 rounded w-20"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-16"})]})]})},s))})})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"mb-8 bg-white rounded-lg shadow-md p-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Arama"}),(0,r.jsx)("input",{type:"text",placeholder:"Ne arıyorsunuz?",value:p,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori"}),(0,r.jsxs)("select",{value:f,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"",children:"T\xfcm Kategoriler"}),null==a?void 0:a.map(e=>(0,r.jsx)("option",{value:e.slug,children:e.name},e.slug))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fiyat Aralığı"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"number",placeholder:"Min",value:w.min,onChange:e=>N({...w,min:e.target.value}),className:"w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)("input",{type:"number",placeholder:"Max",value:w.max,onChange:e=>N({...w,max:e.target.value}),className:"w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sıralama"}),(0,r.jsxs)("select",{value:k,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"premium",children:"\xd6ncelikli"}),(0,r.jsx)("option",{value:"newest",children:"En Yeni"}),(0,r.jsx)("option",{value:"oldest",children:"En Eski"}),(0,r.jsx)("option",{value:"price-low",children:"Fiyat (D\xfcş\xfck-Y\xfcksek)"}),(0,r.jsx)("option",{value:"price-high",children:"Fiyat (Y\xfcksek-D\xfcş\xfck)"}),(0,r.jsx)("option",{value:"views",children:"En \xc7ok G\xf6r\xfcnt\xfclenen"})]})]})]}),(p||f||w.min||w.max||"premium"!==k)&&(0,r.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[T.length," ilan bulundu"]}),(0,r.jsx)("button",{onClick:()=>{b(""),y(""),j(""),N({min:"",max:""}),A("premium"),C(1)},className:"px-4 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:"Filtreleri Temizle"})]})]}),(0,r.jsxs)("div",{className:"flex gap-8",children:[(0,r.jsx)("div",{className:"w-64 flex-shrink-0",children:(0,r.jsx)(m.B,{})}),(0,r.jsxs)("div",{className:"flex-1",children:[e&&(0,r.jsx)(x,{allListings:s}),P.length>0&&(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 mb-6 flex items-center",children:[(0,r.jsx)("span",{className:"text-yellow-500 mr-2",children:"⭐"}),"\xd6ncelikli İlanlar"]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:P.slice(0,3).map(e=>(0,r.jsxs)(i(),{href:"/ilan/".concat(e.id),className:"group bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 cursor-pointer",children:[(0,r.jsxs)("div",{className:"relative h-48 bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center overflow-hidden",children:[e.images&&(Array.isArray(e.images)?e.images.length>0:e.images)?(0,r.jsx)(n.default,{src:Array.isArray(e.images)?e.images[0]:e.images,alt:e.title,fill:!0,className:"object-cover",unoptimized:!0}):(0,r.jsx)("div",{className:"text-gray-400 text-4xl",children:"\uD83D\uDCF7"}),(0,r.jsx)("button",{onClick:s=>{s.preventDefault(),F(e.id)},className:"absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors",children:(0,r.jsx)(o.A,{className:"w-5 h-5 ".concat(L.has(e.id)?"text-red-500 fill-current":"text-gray-400")})}),e.premium&&(0,r.jsx)("div",{className:"absolute top-3 left-3 px-2 py-1 bg-yellow-400 text-yellow-900 text-xs font-bold rounded-full",children:"\xd6NCELİKLİ"})]}),(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-2 group-hover:text-blue-600 transition-colors",children:e.title}),(0,r.jsx)("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:e.description}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("span",{className:"text-lg font-bold text-blue-600",children:["number"==typeof e.price?e.price.toLocaleString("tr-TR"):e.price," ₺"]}),(0,r.jsxs)("div",{className:"flex items-center text-gray-500 text-sm",children:[(0,r.jsx)(c.A,{className:"w-4 h-4 mr-1"}),e.views||0]})]}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[e.location," • ",new Date(e.createdAt).toLocaleDateString("tr-TR")]})]})]},e.id))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"T\xfcm İlanlar"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:I.map(e=>(0,r.jsxs)(i(),{href:"/ilan/".concat(e.id),className:"group bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 cursor-pointer",children:[(0,r.jsxs)("div",{className:"relative h-48 bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center overflow-hidden",children:[e.images&&(Array.isArray(e.images)?e.images.length>0:e.images)?(0,r.jsx)(n.default,{src:Array.isArray(e.images)?e.images[0]:e.images,alt:e.title,fill:!0,className:"object-cover",unoptimized:!0}):(0,r.jsx)("div",{className:"text-gray-400 text-4xl",children:"\uD83D\uDCF7"}),(0,r.jsx)("button",{onClick:s=>{s.preventDefault(),F(e.id)},className:"absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors",children:(0,r.jsx)(o.A,{className:"w-5 h-5 ".concat(L.has(e.id)?"text-red-500 fill-current":"text-gray-400")})}),e.premium&&(0,r.jsx)("div",{className:"absolute top-3 left-3 px-2 py-1 bg-yellow-400 text-yellow-900 text-xs font-bold rounded-full",children:"\xd6NCELİKLİ"})]}),(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-2 group-hover:text-blue-600 transition-colors",children:e.title}),(0,r.jsx)("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:e.description}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("span",{className:"text-lg font-bold text-blue-600",children:["number"==typeof e.price?e.price.toLocaleString("tr-TR"):e.price," ₺"]}),(0,r.jsxs)("div",{className:"flex items-center text-gray-500 text-sm",children:[(0,r.jsx)(c.A,{className:"w-4 h-4 mr-1"}),e.views||0]})]}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[e.location," • ",new Date(e.createdAt).toLocaleDateString("tr-TR")]})]})]},e.id))}),_>1&&(0,r.jsx)("div",{className:"mt-8 flex justify-center",children:(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>z(S-1),disabled:1===S,className:"px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"\xd6nceki"}),Array.from({length:_},(e,s)=>s+1).map(e=>(0,r.jsx)("button",{onClick:()=>z(e),className:"px-3 py-2 text-sm rounded-md ".concat(S===e?"bg-blue-600 text-white":"bg-white border border-gray-300 hover:bg-gray-50"),children:e},e)),(0,r.jsx)("button",{onClick:()=>z(S+1),disabled:S===_,className:"px-3 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Sonraki"})]})})]})]})]})]})})}},12926:(e,s,t)=>{"use strict";t.d(s,{As:()=>o,default:()=>m});var r=t(95155),l=t(12115),a=t(50626);let i=(0,l.createContext)(void 0);function n(e){let{children:s}=e,[t,a]=(0,l.useState)(null),[n,o]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/session");if(e.ok){let s=await e.json();s.user&&a({user:s.user})}}catch(e){console.error("Auth check failed:",e)}finally{o(!1)}})()},[]),(0,r.jsx)(i.Provider,{value:{session:t,isLoading:n,setSession:a},children:s})}function o(){let e=(0,l.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}let c=(0,l.createContext)(void 0);function d(e){let{children:s}=e,[t,i]=(0,l.useState)("tr"),[n,o]=(0,l.useState)(0);return(0,l.useEffect)(()=>(a.Ru.loadLocaleFromStorage(),i(a.Ru.getCurrentLocale()),a.Ru.onLocaleChange(e=>{i(e),o(e=>e+1),window.location.reload()})),[]),(0,r.jsx)(c.Provider,{value:{currentLocale:t,setLocale:e=>{a.Ru.setLocale(e)},forceRefresh:()=>{o(e=>e+1),window.location.reload()}},children:(0,r.jsx)("div",{children:s},n)})}function m(e){let{children:s}=e;return(0,r.jsx)(n,{children:(0,r.jsx)(d,{children:s})})}},64461:(e,s,t)=>{Promise.resolve().then(t.bind(t,4651))}},e=>{e.O(0,[6874,3063,4953,7598,626,7450,8441,5964,7358],()=>e(e.s=64461)),_N_E=e.O()}]);