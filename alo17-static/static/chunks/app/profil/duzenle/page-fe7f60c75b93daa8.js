(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2821],{1376:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var a=r(95155),l=r(12115),s=r(12926),n=r(35695),o=r(66766);let i=l.forwardRef(function(e,t){let{title:r,titleId:a,...s}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},s),r?l.createElement("title",{id:a},r):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))});function d(){var e,t;let{session:r,isLoading:d,setSession:u}=(0,s.As)(),c=(0,n.useRouter)(),[m,h]=(0,l.useState)({name:"",email:"",phone:"",location:"",address:"",birthdate:""}),[f,g]=(0,l.useState)(""),[p,x]=(0,l.useState)(null),[b,y]=(0,l.useState)(!1),[j,v]=(0,l.useState)({type:"",text:""}),[N,w]=(0,l.useState)(!1),[k,S]=(0,l.useState)({current:(null==r||null==(e=r.user)?void 0:e.password)||"",new:"",confirm:""}),[C,P]=(0,l.useState)(""),[E,z]=(0,l.useState)(!1),[O,R]=(0,l.useState)(!1),[_,D]=(0,l.useState)(""),[L,A]=(0,l.useState)(""),[M,T]=(0,l.useState)(!1),[F,G]=(0,l.useState)({email:!0,sms:!1,push:!1}),I=e=>{let{name:t,checked:r}=e.target;G(e=>({...e,[t]:r}))},[K,q]=(0,l.useState)(!1);(0,l.useEffect)(()=>{(null==r?void 0:r.user)&&!K&&(h({name:r.user.name||"",email:r.user.email||"",phone:r.user.phone||"",location:r.user.location||"",address:r.user.address||"",birthdate:r.user.birthdate||""}),g("/images/placeholder.svg"),q(!0)),console.log("Session:",r),r&&console.log("Session expires:",r.expires,"Şu an:",new Date().toISOString())},[r]),(0,l.useEffect)(()=>{var e;N&&(null==r||null==(e=r.user)?void 0:e.password)&&S(e=>({...e,current:r.user.password}))},[N,null==r||null==(t=r.user)?void 0:t.password]);let B=e=>{let{name:t,value:r}=e.target;h(e=>({...e,[t]:r}))},V=e=>{let{name:t,value:r}=e.target;S(e=>({...e,[t]:r}))},H=async e=>{if(e.preventDefault(),P(""),k.new!==k.confirm)return void P("Yeni şifreler eşleşmiyor.");setTimeout(()=>{P("Şifre başarıyla değiştirildi!"),S({current:"",new:"",confirm:""})},1e3)},Y=async()=>{T(!0);let e=Math.floor(1e5+9e5*Math.random()).toString();try{let r=await fetch("/api/send-verification-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:m.email,code:e})});if(r.ok)A(e),R(!0),alert("Doğrulama kodu e-posta adresinize g\xf6nderildi.");else{var t;let e=await r.json();alert("E-posta g\xf6nderilemedi: "+(e.error||"Bilinmeyen hata")+((null==(t=e.detail)?void 0:t.message)?"\n"+e.detail.message:""))}}catch(e){alert("E-posta g\xf6nderilemedi.")}finally{T(!1)}},Z=async e=>{e.preventDefault(),y(!0),v({type:"",text:""});try{let e,t,a={name:m.name,email:m.email,phone:m.phone,location:m.location,address:m.address,birthdate:m.birthdate};console.log("G\xd6NDERİLEN (frontend):",a);try{e=await fetch("/api/users/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),t=await e.json()}catch(e){v({type:"error",text:"Sunucuya bağlanılamadı veya yanıt alınamadı."}),y(!1),console.error("Profil g\xfcncelleme fetch hatası:",e);return}e&&e.ok?(v({type:"success",text:"Profil başarıyla g\xfcncellendi!"}),r&&(console.log("G\xdcNCELLENEN SESSION:",{...r.user,name:m.name,phone:m.phone,location:m.location,address:m.address,birthdate:m.birthdate}),u({...r,user:{...r.user,name:m.name,phone:m.phone,location:m.location,address:m.address,birthdate:m.birthdate}})),setTimeout(()=>{c.push("/profil?updated=true")},1500)):(v({type:"error",text:t&&t.error||"Profil g\xfcncellenirken hata oluştu."}),console.error("Profil g\xfcncelleme API hatası:",t))}catch(e){v({type:"error",text:"Bir hata oluştu. L\xfctfen tekrar deneyin."})}finally{y(!1)}};return d?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"Y\xfckleniyor..."}):d||r?r&&"admin"!==r.user.role&&"user"!==r.user.role?(c.push("/"),null):(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Profil D\xfczenle"}),j.text&&(0,a.jsx)("div",{className:"mb-4 p-4 rounded-lg ".concat("success"===j.type?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:j.text}),(0,a.jsxs)("form",{onSubmit:Z,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-32 h-32 rounded-full overflow-hidden bg-gray-200",children:(0,a.jsx)(o.default,{src:f||"/images/placeholder.svg",alt:"Profil fotoğrafı",width:128,height:128,className:"w-full h-full object-cover"})}),(0,a.jsxs)("label",{className:"absolute bottom-0 right-0 p-2 bg-alo-orange text-white rounded-full cursor-pointer hover:bg-orange-600 transition-colors",children:[(0,a.jsx)(i,{className:"w-4 h-4"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];if(r){x(r);let e=new FileReader;e.onload=e=>{var t;g(null==(t=e.target)?void 0:t.result)},e.readAsDataURL(r)}},className:"hidden"})]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Profil fotoğrafınızı değiştirmek i\xe7in tıklayın"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Ad Soyad"}),(0,a.jsx)("input",{type:"text",id:"name",name:"name",value:m.name,onChange:B,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-alo-orange focus:border-transparent",placeholder:"Adınız Soyadınız",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"E-posta"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"email",id:"email",name:"email",value:m.email,onChange:B,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-alo-orange focus:border-transparent",placeholder:"ornek@email.com",required:!0}),(0,a.jsx)("button",{type:"button",onClick:Y,className:"px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50",disabled:O||M,children:M?"G\xf6nderiliyor...":"Doğrulama Kodu G\xf6nder"})]}),O&&(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"Kod",value:_,onChange:e=>D(e.target.value),className:"w-32 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("button",{type:"button",onClick:()=>{_===L?(alert("E-posta doğrulandı!"),R(!1),D(""),A("")):alert("Kod yanlış!")},className:"px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600",children:"Doğrula"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefon"}),(0,a.jsx)("input",{type:"tel",id:"phone",name:"phone",value:m.phone,onChange:B,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-alo-orange focus:border-transparent",placeholder:"+90 555 123 4567"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700 mb-2",children:"Konum"}),(0,a.jsx)("input",{type:"text",id:"location",name:"location",value:m.location,onChange:B,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-alo-orange focus:border-transparent",placeholder:"İl, İl\xe7e"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-2",children:"Adres"}),(0,a.jsx)("textarea",{id:"address",name:"address",value:m.address,onChange:B,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-alo-orange focus:border-transparent resize-none",placeholder:"Detaylı adres bilgisi"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"birthdate",className:"block text-sm font-medium text-gray-700 mb-2",children:"Doğum Tarihi"}),(0,a.jsx)("input",{type:"date",id:"birthdate",name:"birthdate",value:m.birthdate,onChange:B,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-alo-orange focus:border-transparent"})]})]}),(0,a.jsxs)("div",{className:"flex space-x-4 pt-6",children:[(0,a.jsx)("button",{type:"submit",disabled:b,className:"flex-1 bg-alo-orange text-white py-3 px-6 rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?"G\xfcncelleniyor...":"Profili G\xfcncelle"}),(0,a.jsx)("button",{type:"button",onClick:()=>c.push("/profil"),className:"flex-1 bg-gray-200 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors",children:"İptal"})]})]}),(0,a.jsxs)("div",{className:"mt-10",children:[(0,a.jsx)("button",{type:"button",onClick:()=>w(e=>!e),className:"text-alo-orange font-medium hover:underline",children:N?"Şifre Değiştirmeyi Kapat":"Şifre Değiştir"}),N&&(0,a.jsxs)("form",{onSubmit:H,className:"mt-4 bg-gray-50 rounded-lg p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mevcut Şifre"}),(0,a.jsx)("input",{type:"password",name:"current",value:k.current,onChange:V,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-alo-orange",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yeni Şifre"}),(0,a.jsx)("input",{type:"password",name:"new",value:k.new,onChange:V,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-alo-orange",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Yeni Şifre (Tekrar)"}),(0,a.jsx)("input",{type:"password",name:"confirm",value:k.confirm,onChange:V,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-alo-orange",required:!0})]}),C&&(0,a.jsx)("div",{className:"text-sm text-green-600",children:C}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-alo-orange text-white py-2 rounded-lg hover:bg-orange-600",children:"Şifreyi Değiştir"})]})]}),(0,a.jsxs)("div",{className:"mt-10 bg-gray-50 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Bildirim Tercihleri"}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("label",{className:"flex items-center gap-3",children:[(0,a.jsx)("input",{type:"checkbox",name:"email",checked:F.email,onChange:I,className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),(0,a.jsx)("span",{className:"text-gray-700",children:"E-posta ile bildirim almak istiyorum"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-3",children:[(0,a.jsx)("input",{type:"checkbox",name:"sms",checked:F.sms,onChange:I,className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),(0,a.jsx)("span",{className:"text-gray-700",children:"SMS ile bildirim almak istiyorum"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-3",children:[(0,a.jsx)("input",{type:"checkbox",name:"push",checked:F.push,onChange:I,className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),(0,a.jsx)("span",{className:"text-gray-700",children:"Push (anlık) bildirim almak istiyorum"})]})]})]}),(0,a.jsx)("div",{className:"mt-10",children:(0,a.jsx)("button",{type:"button",onClick:()=>z(!0),className:"w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 font-semibold",children:"Hesabımı Kalıcı Olarak Sil"})}),E&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 text-red-600",children:"Hesabınızı silmek \xfczeresiniz!"}),(0,a.jsx)("p",{className:"mb-6",children:"Bu işlem geri alınamaz. T\xfcm verileriniz kalıcı olarak silinecek. Devam etmek istiyor musunuz?"}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)("button",{onClick:()=>z(!1),className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Vazge\xe7"}),(0,a.jsx)("button",{onClick:()=>{z(!1),alert("Hesabınız kalıcı olarak silindi (mock).")},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Evet, Hesabımı Sil"})]})]})})]})})}):(c.push("/giris"),null)}},6654:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return l}});let a=r(12115);function l(e,t){let r=(0,a.useRef)(null),l=(0,a.useRef)(null);return(0,a.useCallback)(a=>{if(null===a){let e=r.current;e&&(r.current=null,e());let t=l.current;t&&(l.current=null,t())}else e&&(r.current=s(e,a)),t&&(l.current=s(t,a))},[e,t])}function s(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},12926:(e,t,r)=>{"use strict";r.d(t,{As:()=>i,default:()=>c});var a=r(95155),l=r(12115),s=r(50626);let n=(0,l.createContext)(void 0);function o(e){let{children:t}=e,[r,s]=(0,l.useState)(null),[o,i]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.user&&s({user:t.user})}}catch(e){console.error("Auth check failed:",e)}finally{i(!1)}})()},[]),(0,a.jsx)(n.Provider,{value:{session:r,isLoading:o,setSession:s},children:t})}function i(){let e=(0,l.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}let d=(0,l.createContext)(void 0);function u(e){let{children:t}=e,[r,n]=(0,l.useState)("tr"),[o,i]=(0,l.useState)(0);return(0,l.useEffect)(()=>(s.Ru.loadLocaleFromStorage(),n(s.Ru.getCurrentLocale()),s.Ru.onLocaleChange(e=>{n(e),i(e=>e+1),window.location.reload()})),[]),(0,a.jsx)(d.Provider,{value:{currentLocale:r,setLocale:e=>{s.Ru.setLocale(e)},forceRefresh:()=>{i(e=>e+1),window.location.reload()}},children:(0,a.jsx)("div",{children:t},o)})}function c(e){let{children:t}=e;return(0,a.jsx)(o,{children:(0,a.jsx)(u,{children:t})})}},35695:(e,t,r)=>{"use strict";var a=r(18999);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},66766:(e,t,r)=>{"use strict";r.d(t,{default:()=>l.a});var a=r(71469),l=r.n(a)},71469:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return i},getImageProps:function(){return o}});let a=r(38466),l=r(38883),s=r(33063),n=a._(r(51193));function o(e){let{props:t}=(0,l.getImgProps)(e,{defaultLoader:n.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let i=s.Image},93756:(e,t,r)=>{Promise.resolve().then(r.bind(r,1376))}},e=>{e.O(0,[3063,626,8441,5964,7358],()=>e(e.s=93756)),_N_E=e.O()}]);